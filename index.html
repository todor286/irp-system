<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WorkTrack - Система за отчитане на работа</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/qrcode-generator@1.4.4/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>
</head>
<body>
    <header>
        <div class="container header-content">
            <div class="logo">WorkTrack - Обща система</div>
            <nav>
                <ul>
                    <li><a href="#" onclick="showPage('home')">Начало</a></li>
                    <li><a href="#" onclick="showPage('tasks')">Задачи</a></li>
                    <li><a href="#" onclick="showPage('materials')">Материали</a></li>
                    <li><a href="#" onclick="showPage('reports')">Отчитания</a></li>
                    <li><a href="#" onclick="showPage('scan')">Сканиране</a></li>
                    <li><a href="#" onclick="showPage('sync')">Синхронизация</a></li>
                </ul>
            </nav>
            <div class="auth-buttons" id="authButtons">
                <button onclick="showPage('login')">Вход</button>
                <button onclick="showPage('register')">Регистрация</button>
            </div>
            <div class="user-info" id="userInfo" style="display: none;">
                <div class="user-avatar" id="userAvatar">U</div>
                <span id="userName">Потребител</span>
                <button onclick="logout()" style="margin-left: 15px;">Изход</button>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Начална страница -->
        <div id="home" class="page active">
            <div class="card">
                <h2>Добре дошли в общата система WorkTrack</h2>
                <p>Система за отчитане на работа чрез QR кодове. Всички потребители виждат едни и същи задачи, материали и отчети.</p>
                
                <div class="flex" style="margin-top: 30px;">
                    <div style="flex: 1; padding: 15px;">
                        <h3>За компютър</h3>
                        <p>Създавайте задачи и материали, генерирайте QR кодове и следете отчетената работа.</p>
                        <button onclick="showPage('tasks')" style="margin-top: 15px;">Създаване на задачи</button>
                    </div>
                    <div style="flex: 1; padding: 15px;">
                        <h3>За телефон</h3>
                        <p>Сканирайте QR кодове за отчитане на работа и материали.</p>
                        <button onclick="showPage('scan')" style="margin-top: 15px;">Сканиране</button>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h2>Последни отчитания</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Задача</th>
                            <th>Потребител</th>
                            <th>Дата</th>
                            <th>Статус</th>
                        </tr>
                    </thead>
                    <tbody id="recentReports">
                        <!-- Данните ще се попълнят от JavaScript -->
                    </tbody>
                </table>
            </div>

            <div class="card">
                <h2>Синхронизация на данни</h2>
                <p>За да споделяте данни между различни устройства, използвайте опциите за експорт и импорт на данни.</p>
                <div class="data-management">
                    <button class="btn-info" onclick="showPage('sync')">Управление на данните</button>
                </div>
            </div>
        </div>

        <!-- Вход -->
        <div id="login" class="page">
            <div class="card">
                <h2>Вход в системата</h2>
                <form id="loginForm">
                    <div class="form-group">
                        <label for="loginEmail">Имейл</label>
                        <input type="email" id="loginEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Парола</label>
                        <input type="password" id="loginPassword" required>
                    </div>
                    <button type="submit">Вход</button>
                </form>
                <p style="margin-top: 15px;">Нямате профил? <a href="#" onclick="showPage('register')">Регистрирайте се</a></p>
            </div>
        </div>

        <!-- Регистрация -->
        <div id="register" class="page">
            <div class="card">
                <h2>Регистрация</h2>
                <form id="registerForm">
                    <div class="form-group">
                        <label for="registerName">Име</label>
                        <input type="text" id="registerName" required>
                    </div>
                    <div class="form-group">
                        <label for="registerEmail">Имейл</label>
                        <input type="email" id="registerEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="registerPassword">Парола</label>
                        <input type="password" id="registerPassword" required>
                    </div>
                    <button type="submit">Регистрация</button>
                </form>
                <p style="margin-top: 15px;">Вече имате профил? <a href="#" onclick="showPage('login')">Влезте в системата</a></p>
            </div>
        </div>

        <!-- Задачи -->
        <div id="tasks" class="page">
            <div class="card">
                <h2>Създаване на задачи</h2>
                <form id="taskForm">
                    <div class="form-group">
                        <label for="taskName">Име на задачата</label>
                        <input type="text" id="taskName" required>
                    </div>
                    <div class="form-group">
                        <label for="taskDescription">Описание</label>
                        <textarea id="taskDescription" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="taskMaterials">Материали (разделени със запетая)</label>
                        <input type="text" id="taskMaterials" placeholder="материал1, материал2, ...">
                    </div>
                    <button type="submit">Създай задача и генерирай QR код</button>
                </form>
            </div>
            
            <div class="card">
                <h2>Генериран QR код</h2>
                <div class="qr-container">
                    <div id="qrCode"></div>
                </div>
                <div style="text-align: center; margin-top: 15px;">
                    <button onclick="generateQRForSelectedTask()">Генерирай QR код за избрана задача</button>
                </div>
            </div>
            
            <div class="card">
                <h2>Общ списък с задачи</h2>
                <div class="task-list" id="taskList">
                    <!-- Задачите ще се добавят тук -->
                </div>
            </div>
        </div>

        <!-- Материали -->
        <div id="materials" class="page">
            <div class="card">
                <h2>Създаване на материали</h2>
                <form id="materialForm">
                    <div class="form-group">
                        <label for="materialName">Име на материала</label>
                        <input type="text" id="materialName" required>
                    </div>
                    <div class="form-group">
                        <label for="materialQuantity">Количество</label>
                        <input type="number" id="materialQuantity" required>
                    </div>
                    <div class="form-group">
                        <label for="materialDescription">Описание</label>
                        <textarea id="materialDescription" rows="3"></textarea>
                    </div>
                    <button type="submit">Създай материал и генерирай QR код</button>
                </form>
            </div>
            
            <div class="card">
                <h2>Генериран QR код</h2>
                <div class="qr-container">
                    <div id="materialQrCode"></div>
                </div>
            </div>
            
            <div class="card">
                <h2>Общ списък с материали</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Материал</th>
                            <th>Количество</th>
                            <th>Описание</th>
                            <th>Създал</th>
                            <th>Статус</th>
                            <th>Действия</th>
                        </tr>
                    </thead>
                    <tbody id="materialList">
                        <!-- Материалите ще се добавят тук -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Отчитания -->
        <div id="reports" class="page">
            <div class="card">
                <h2>Общи отчитания на работа</h2>
                <div style="margin-bottom: 15px;">
                    <button onclick="clearAllReports()" class="btn-danger">Изтрий всички отчети</button>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Задача/Материал</th>
                            <th>Потребител</th>
                            <th>Дата</th>
                            <th>Тип</th>
                            <th>Статус</th>
                        </tr>
                    </thead>
                    <tbody id="reportsList">
                        <!-- Отчитанията ще се добавят тук -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Сканиране -->
        <div id="scan" class="page">
            <div class="card">
                <h2>Сканиране на QR код</h2>
                <p>Позволете достъп до камерата за да сканирате QR кодове за отчитане на работа и материали.</p>
                
                <div class="scan-area">
                    <video id="video" autoplay muted playsinline></video>
                </div>
                
                <div id="scanResult"></div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <button id="startScan">Стартирай сканиране</button>
                    <button id="stopScan" style="display: none;">Спри сканирането</button>
                </div>
            </div>
        </div>

        <!-- Синхронизация -->
        <div id="sync" class="page">
            <div class="card">
                <h2>Синхронизация на данни</h2>
                <p>Използвайте тези опции за да споделяте данни между различни устройства.</p>
                
                <div class="data-management">
                    <button class="btn-success" onclick="exportData()">Експортирай всички данни</button>
                    <button class="btn-warning" onclick="document.getElementById('importFile').click()">Импортирай данни</button>
                    <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">
                    <button class="btn-info" onclick="generateDataQR()">Генерирай QR код с данни</button>
                    <button class="btn-danger" onclick="clearAllData()">Изтрий всички данни</button>
                </div>
                
                <div id="dataQRCode" class="qr-container" style="display: none; margin-top: 20px;">
                    <h3>QR код с данните</h3>
                    <p>Сканирайте този QR код на друго устройство за да импортирате данните</p>
                </div>
                
                <div id="syncResult" style="margin-top: 20px;"></div>
            </div>
            
            <div class="card">
                <h2>Статистика</h2>
                <div id="stats">
                    <!-- Статистиката ще се покаже тук -->
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>